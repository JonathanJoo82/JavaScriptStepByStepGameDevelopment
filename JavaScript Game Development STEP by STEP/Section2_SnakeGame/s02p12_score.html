<html>
    <head>
        <title>Snake Game</title>
    </head>
    <body>
        <canvas height="500" width="500" style="border:2px solid#000000" id="ctx"/>
        <script>
            var ctx = document.getElementById('ctx').getContext('2d');
            ctx.font = "20px Calibri";
            var snakeList, foodList, direction, eatenFood1, eatenFood2, intervalVar, score;
            var image = new Image();
            

            var canvasDimensions = {
                width:500,
                height:500
            };

            var snakeBody = {
                width:20,
                height:20,
                color:'green'
            };

            var food = {
                width:20,
                height:20,
                color:'orange'
            };

            document.onkeydown = function(event){
                //0 - Left
                //1 - up
                //2 - Right
                //3 - Down
                if(event.keyCode == 37 || event.keyCode == 65){
                    direction = 0;
                } else if(event.keyCode == 38 || event.keyCode == 87){
                    direction = 1;
                } else if(event.keyCode == 39 || event.keyCode == 68){
                    direction = 2;
                } else if(event.keyCode == 40 || event.keyCode == 83){
                    direction = 3;
                }
            }

            function startGame(){
                snakeList = [
                    {x:230, y:200},
                    {x:220, y:200},
                    {x:210, y:200},
                    {x:200, y:200}
                ];
                foodList = [];
                direction=99;
                eatenFood1 = true;
                eatenFood2 = true;
                score = 0;
                intervalVar = setInterval(updateSnakePosition, 15);
            }

            function isGameOver(){
                for(i in snakeList){
                    if(i==0)
                        continue;
                    
                    if(testCollisionSnake(snakeList[0], snakeList[i])){
                        clearInterval(intervalVar);
                        image.src = 'kitten.png';
                        image.onload = function(){
                            ctx.drawImage(image, 20, 20); 
                        }
                        ctx.fillText("Game Over! Click to restart", 150,50);

                        return;
                    }
                }
            }

            function testCollisionSnake(snake1, snake2){
                return ((Math.abs(snake1.x-snake2.x)<5) && (Math.abs(snake1.y-snake2.y)<5));
            }


            //snakebody = sb from startgame
            function drawSnake(sb, i){
                ctx.save();

                if(i == 0){
                    ctx.fillStyle = 'black'
                } else{
                    ctx.fillStyle = snakeBody.color;
                }
                ctx.fillRect(sb.x, sb.y, snakeBody.width, snakeBody.height);

                ctx.restore();
            }

            function drawFood(f, i){
                ctx.save();
                ctx.fillStyle = food.color;
                ctx.fillRect(f.x, f.y, food.width, food.height);
                ctx.restore();
            }

            function updateSnakeList(){
                for(var i=snakeList.length-1; i>=0; i--){
                    if(direction == 0){
                        if(i==0){
                          snakeList[i].x = snakeList[i].x - 5;
                        } else {
                         snakeList[i].x = snakeList[i-1].x;
                         snakeList[i].y = snakeList[i-1].y;
                        }
                    } else if (direction == 1){
                        if(i==0){
                          snakeList[i].y = snakeList[i].y - 5;
                        } else {
                         snakeList[i].x = snakeList[i-1].x;
                         snakeList[i].y = snakeList[i-1].y;
                        }
                    } else if (direction == 2){
                        if(i==0){
                          snakeList[i].x = snakeList[i].x + 5;
                        } else {
                         snakeList[i].x = snakeList[i-1].x;
                         snakeList[i].y = snakeList[i-1].y;
                        }
                    } else if (direction == 3){
                        if(i==0){
                          snakeList[i].y = snakeList[i].y + 5;
                        } else {
                         snakeList[i].x = snakeList[i-1].x;
                         snakeList[i].y = snakeList[i-1].y;
                        }
                    } 
                }
            }

            function updateSnakePosition(){
                ctx.clearRect(0,0,canvasDimensions.width,canvasDimensions.height);
                if(eatenFood1 && eatenFood2){
                    if(eatenFood1){
                        //generate new food

                        //create the food position
                        var food_x_position = Math.random() * 485 + 5;
                        var food_y_position = Math.random() * 485 + 5;
                        foodList[0] = {x:food_x_position,y:food_y_position};
                        eatenFood1 = false;
                    }
                    if(eatenFood2){
                        var food2_x_position = Math.random() * 485 + 5;
                        var food2_y_position = Math.random() * 485 + 5;
                        foodList[1] = {x:food2_x_position,y:food2_y_position};
                        eatenFood2=false;
                    }
                }
                foodList.forEach(drawFood);
                snakeList.forEach(drawSnake);

                if(testCollision(snakeList[0],foodList[0])){
                    foodList[0] = {};
                    eatenFood1 = true;
                    score += 1;
                    var new_x, new_y;
                    if(direction == 0){
                        new_x = snakeList[0].x - 10;
                        new_y = snakeList[0].y;
                    } else if (direction == 1){
                        new_x = snakeList[0].x;
                        new_y = snakeList[0].y - 10;
                    } else if (direction == 2){
                        new_x = snakeList[0].x + 10;
                        new_y = snakeList[0].y;
                    } else if (direction == 3){
                        new_x = snakeList[0].x;
                        new_y = snakeList[0].y + 10;
                    }
                    snakeList.unshift({x:new_x, y:new_y});
                }

                if(testCollision(snakeList[0],foodList[1])){
                    foodList[1] = {};
                    eatenFood2 = true;
                    score += 1;
                    var new_x, new_y;
                    if(direction == 0){
                        new_x = snakeList[0].x - 10;
                        new_y = snakeList[0].y;
                    } else if (direction == 1){
                        new_x = snakeList[0].x;
                        new_y = snakeList[0].y - 10;
                    } else if (direction == 2){
                        new_x = snakeList[0].x + 10;
                        new_y = snakeList[0].y;
                    } else if (direction == 3){
                        new_x = snakeList[0].x;
                        new_y = snakeList[0].y + 10;
                    }
                    snakeList.unshift({x:new_x, y:new_y});
                }
                ctx.fillText('Score: '+ score, 420, 30);
                isGameOver();
                checkSnakePosition();
                updateSnakeList();
            }

            function testCollision(snakeRect1, foodRect2){
                    return ((snakeRect1.x <= foodRect2.x + food.width) && 
                            (foodRect2.x <= snakeRect1.x + snakeBody.width) &&
                            (snakeRect1.y <= foodRect2.y + food.height) &&
                            (foodRect2.y <= snakeRect1.y + snakeBody.height));
                }
            /*
                Challenge. Make it so that hitting the boundaries will be game over.
            */
            function checkSnakePosition(){
                if (snakeList[0].x > 500){
                    snakeList[0].x = 0;
                } else if(snakeList[0].x < 0){
                    snakeList[0].x = 500;
                } else if(snakeList[0].y>500){
                    snakeList[0].y = 0;
                }else if(snakeList[0].y < 0){
                    snakeList[0].y = 500;
                }
            }

            startGame();

        </script>
    </body>
</html>